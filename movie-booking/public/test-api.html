<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API ƒê·∫∑t V√©</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            border-left: 4px solid #007bff;
        }
        .success {
            color: #28a745;
        }
        .error {
            color: #dc3545;
        }
        input, select {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>üé¨ Test API ƒê·∫∑t V√© Nhanh</h1>

    <!-- Test 1: Get All Movies -->
    <div class="test-section">
        <h2>1. Test: L·∫•y danh s√°ch phim</h2>
        <button onclick="testMovies()">Test Movies</button>
        <pre id="movies-result">Ch∆∞a test...</pre>
    </div>

    <!-- Test 2: Get All Cinemas -->
    <div class="test-section">
        <h2>2. Test: L·∫•y danh s√°ch r·∫°p</h2>
        <button onclick="testCinemas()">Test Cinemas</button>
        <pre id="cinemas-result">Ch∆∞a test...</pre>
    </div>

    <!-- Test 3: Get Dates -->
    <div class="test-section">
        <h2>3. Test: L·∫•y ng√†y chi·∫øu</h2>
        <label>Movie ID: <input type="number" id="test-movie-id" value="1"></label>
        <label>Cinema ID: <input type="number" id="test-cinema-id" value="1"></label>
        <button onclick="testDates()">Test Get Dates</button>
        <pre id="dates-result">Ch∆∞a test...</pre>
    </div>

    <!-- Test 4: Get Showtimes -->
    <div class="test-section">
        <h2>4. Test: L·∫•y su·∫•t chi·∫øu</h2>
        <label>Movie ID: <input type="number" id="test-showtime-movie-id" value="1"></label>
        <label>Cinema ID: <input type="number" id="test-showtime-cinema-id" value="1"></label>
        <label>Date: <input type="date" id="test-date" value="2025-12-06"></label>
        <button onclick="testShowtimes()">Test Get Showtimes</button>
        <pre id="showtimes-result">Ch∆∞a test...</pre>
    </div>

    <!-- Test 5: Check Database -->
    <div class="test-section">
        <h2>5. Test: Ki·ªÉm tra database</h2>
        <button onclick="testDatabase()">Test Database</button>
        <pre id="database-result">Ch∆∞a test...</pre>
    </div>

    <script>
        async function testMovies() {
            const result = document.getElementById('movies-result');
            result.textContent = 'Loading...';
            
            try {
                const response = await fetch('/');
                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const movieSelect = doc.querySelector('#movie');
                const options = movieSelect ? Array.from(movieSelect.querySelectorAll('option')).map(o => ({
                    value: o.value,
                    text: o.textContent
                })) : [];
                
                result.innerHTML = `<span class="success">‚úì Success!</span>\n${JSON.stringify(options, null, 2)}`;
            } catch (error) {
                result.innerHTML = `<span class="error">‚úó Error:</span>\n${error.message}`;
            }
        }

        async function testCinemas() {
            const result = document.getElementById('cinemas-result');
            result.textContent = 'Loading...';
            
            try {
                const response = await fetch('/');
                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const cinemaSelect = doc.querySelector('#cinema');
                const options = cinemaSelect ? Array.from(cinemaSelect.querySelectorAll('option')).map(o => ({
                    value: o.value,
                    text: o.textContent
                })) : [];
                
                result.innerHTML = `<span class="success">‚úì Success!</span>\n${JSON.stringify(options, null, 2)}`;
            } catch (error) {
                result.innerHTML = `<span class="error">‚úó Error:</span>\n${error.message}`;
            }
        }

        async function testDates() {
            const result = document.getElementById('dates-result');
            result.textContent = 'Loading...';
            
            const movieId = document.getElementById('test-movie-id').value;
            const cinemaId = document.getElementById('test-cinema-id').value;
            
            try {
                const response = await fetch(`/get-dates?movie_id=${movieId}&cinema_id=${cinemaId}`);
                const data = await response.json();
                
                result.innerHTML = `<span class="success">‚úì Success!</span>\nURL: /get-dates?movie_id=${movieId}&cinema_id=${cinemaId}\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                result.innerHTML = `<span class="error">‚úó Error:</span>\n${error.message}`;
            }
        }

        async function testShowtimes() {
            const result = document.getElementById('showtimes-result');
            result.textContent = 'Loading...';
            
            const movieId = document.getElementById('test-showtime-movie-id').value;
            const cinemaId = document.getElementById('test-showtime-cinema-id').value;
            const date = document.getElementById('test-date').value;
            
            try {
                const response = await fetch(`/search-showtime?movie_id=${movieId}&cinema_id=${cinemaId}&date_start=${date}`);
                const data = await response.json();
                
                result.innerHTML = `<span class="success">‚úì Success!</span>\nURL: /search-showtime?movie_id=${movieId}&cinema_id=${cinemaId}&date_start=${date}\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                result.innerHTML = `<span class="error">‚úó Error:</span>\n${error.message}`;
            }
        }

        async function testDatabase() {
            const result = document.getElementById('database-result');
            result.innerHTML = `
<span class="success">H∆∞·ªõng d·∫´n ki·ªÉm tra database:</span>

1. M·ªü phpMyAdmin ho·∫∑c MySQL client
2. Ch·∫°y c√°c query sau:

-- Ki·ªÉm tra c√≥ phim kh√¥ng
SELECT id, title FROM movies LIMIT 5;

-- Ki·ªÉm tra c√≥ r·∫°p kh√¥ng
SELECT id, name FROM cinemas LIMIT 5;

-- Ki·ªÉm tra c√≥ ph√≤ng kh√¥ng
SELECT id, cinema_id, name FROM rooms LIMIT 5;

-- Ki·ªÉm tra c√≥ su·∫•t chi·∫øu kh√¥ng
SELECT id, movie_id, room_id, date_start, start_time 
FROM showtimes 
LIMIT 10;

-- Ki·ªÉm tra relationship
SELECT 
    s.id,
    m.title as movie,
    c.name as cinema,
    r.name as room,
    s.date_start,
    s.start_time
FROM showtimes s
JOIN movies m ON s.movie_id = m.id
JOIN rooms r ON s.room_id = r.id
JOIN cinemas c ON r.cinema_id = c.id
LIMIT 10;
            `;
        }
    </script>
</body>
</html>
